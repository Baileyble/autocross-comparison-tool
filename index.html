<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RaceCompare.app | Autocross Video Compare</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;500;600;700&family=Bebas+Neue&family=Share+Tech+Mono&display=swap" rel="stylesheet" />
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        :root {
            --accent-orange: #ff6b35;
            --accent-teal: #00d9ff;
            --accent-lime: #a8ff00;
            --warning-red: #ff3366;
            --deep-black: #000000;
            --surface-dark: #0a0a0a;
            --surface-mid: #151515;
            --surface-light: #1f1f1f;
            --border-color: #2a2a2a;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-muted: #606060;
            --gradient-1: linear-gradient(135deg, #ff6b35 0%, #ff3366 100%);
            --gradient-2: linear-gradient(135deg, #00d9ff 0%, #00ff88 100%);
            --gradient-3: linear-gradient(135deg, #a8ff00 0%, #00d9ff 100%);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--deep-black);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        .bg-mesh { position: fixed; inset: 0; z-index: -1; overflow: hidden; }
        .mesh-gradient {
            position: absolute; width: 300%; height: 300%; top: -100%; left: -100%;
            background: radial-gradient(circle at 20% 80%, rgba(255,107,53,.1) 0%, transparent 55%),
                        radial-gradient(circle at 80% 20%, rgba(0,217,255,.1) 0%, transparent 55%),
                        radial-gradient(circle at 40% 40%, rgba(168,255,0,.06) 0%, transparent 60%);
            animation: meshRotate 30s linear infinite;
            will-change: transform;
        }
        @keyframes meshRotate { 0%{transform:rotate(0)} 100%{transform:rotate(360deg)} }
        .data-streams { position: fixed; inset: 0; z-index: -1; opacity:.3; }
        .stream { position:absolute; width:1px; height:100px; background:linear-gradient(to bottom,transparent,var(--accent-teal),transparent); animation:dataFlow 3s linear infinite; }
        .stream:nth-child(1){left:10%} .stream:nth-child(2){left:30%} .stream:nth-child(3){left:50%} .stream:nth-child(4){left:70%} .stream:nth-child(5){left:90%}
        @keyframes dataFlow { 0%{transform:translateY(-100px);opacity:0} 10%,90%{opacity:1} 100%{transform:translateY(100vh);opacity:0} }

        .dashboard-header { background:var(--surface-dark); border-bottom:1px solid var(--border-color); padding:2rem 0; position:relative; overflow:hidden; }
        .header-content { max-width:1400px; margin:0 auto; padding:0 2rem; display:flex; justify-content:space-between; align-items:center; }
        .logo-section { display:flex; align-items:center; gap:2rem; }
        .logo { font-family:'Bebas Neue', sans-serif; font-size:3rem; letter-spacing:.08em; background:var(--gradient-1); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
        .status-indicator { display:flex; align-items:center; gap:.5rem; padding:.5rem 1.5rem; background:var(--surface-mid); border:1px solid var(--border-color); border-radius:50px; }
        .status-dot { width:8px; height:8px; background:var(--accent-lime); border-radius:50%; animation:statusPulse 2s ease-in-out infinite; }
        @keyframes statusPulse { 0%,100%{transform:scale(1); box-shadow:0 0 0 0 rgba(168,255,0,.7)} 50%{transform:scale(1.1); box-shadow:0 0 0 10px rgba(168,255,0,0)} }
        .status-text { font-family:'Share Tech Mono',monospace; font-size:.875rem; color:var(--accent-lime); text-transform:uppercase; letter-spacing:.05em; }

        .dashboard-container { max-width:1400px; margin:0 auto; padding:2rem; }
        .config-section { display:grid; grid-template-columns:1fr 1fr; gap:2rem; margin-bottom:2rem; opacity:0; animation:fadeInUp .8s ease-out forwards; }
        @keyframes fadeInUp { from{opacity:0;transform:translateY(30px)} to{opacity:1;transform:translateY(0)} }
        @media (max-width:1024px){ .config-section{grid-template-columns:1fr} }
        .config-card { background:var(--surface-dark); border:1px solid var(--border-color); border-radius:12px; overflow:hidden; position:relative; transition:.3s; }
        .config-card:hover { transform:translateY(-5px); border-color:var(--accent-orange); box-shadow:0 20px 40px rgba(255,107,53,.1); }
        .config-card::before { content:''; position:absolute; top:0; left:0; right:0; height:4px; background:var(--gradient-1); transform:scaleX(0); transform-origin:left; transition:transform .5s ease; }
        .config-card:nth-child(2)::before { background:var(--gradient-2); }
        .config-card:hover::before { transform:scaleX(1); }
        .card-header { padding:1.5rem; background:var(--surface-mid); border-bottom:1px solid var(--border-color); }
        .card-label { display:flex; align-items:center; gap:1rem; }
        .run-badge { width:48px; height:48px; background:var(--gradient-1); border-radius:8px; display:flex; align-items:center; justify-content:center; font-family:'Bebas Neue',sans-serif; font-size:1.5rem; font-weight:700; color:var(--text-primary); position:relative; overflow:hidden; }
        .config-card:nth-child(2) .run-badge { background:var(--gradient-2); }
        .run-badge::after { content:''; position:absolute; top:-50%; left:-50%; width:200%; height:200%; background:linear-gradient(45deg,transparent,rgba(255,255,255,.1),transparent); animation:shimmer 3s infinite; }
        @keyframes shimmer{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
        .card-title { font-size:1.25rem; font-weight:600; color:var(--text-primary); margin:0; }
        .card-subtitle { font-size:.875rem; color:var(--text-muted); margin:0; }
        .card-body { padding:1.5rem; }
        .form-group { margin-bottom:1.5rem; }
        .form-label { display:block; font-size:.875rem; font-weight:600; color:var(--text-secondary); margin-bottom:.5rem; text-transform:uppercase; letter-spacing:.05em; }
        .form-input { width:100%; padding:.875rem 1rem; background:var(--surface-light); border:1px solid var(--border-color); border-radius:6px; color:var(--text-primary); font-family:'Rajdhani',sans-serif; font-size:1rem; font-weight:500; transition:.3s; }
        .form-input:focus { outline:none; border-color:var(--accent-teal); background:rgba(0,217,255,.05); box-shadow:0 0 0 3px rgba(0,217,255,.1); }

        .control-center { background:var(--surface-dark); border:1px solid var(--border-color); border-radius:12px; padding:2rem; margin-bottom:2rem; opacity:0; animation:fadeInUp .8s ease-out .2s forwards; }
        .control-actions { display:flex; gap:1rem; justify-content:center; flex-wrap:wrap; }
        .btn { padding:1rem 2rem; border:none; border-radius:6px; font-family:'Rajdhani',sans-serif; font-size:1rem; font-weight:600; text-transform:uppercase; letter-spacing:.05em; cursor:pointer; position:relative; overflow:hidden; transition:.3s; display:inline-flex; align-items:center; gap:.5rem; }
        .btn::before { content:''; position:absolute; top:50%; left:50%; width:0; height:0; background:rgba(255,255,255,.1); border-radius:50%; transform:translate(-50%,-50%); transition:width .6s, height .6s; }
        .btn:hover::before { width:300px; height:300px; }
        .btn-primary { background:var(--gradient-1); color:var(--text-primary); box-shadow:0 4px 20px rgba(255,107,53,.3); }
        .btn-primary:hover { transform:translateY(-2px); box-shadow:0 8px 30px rgba(255,107,53,.4); }
        .btn-secondary { background:var(--surface-mid); color:var(--text-primary); border:1px solid var(--border-color); }
        .btn-secondary:hover { border-color:var(--accent-teal); background:rgba(0,217,255,.1); transform:translateY(-2px); }
        .btn-danger { background:var(--warning-red); color:#fff; }

        .analysis-dashboard { display:none; opacity:0; }
        .analysis-dashboard.active { display:block; animation:dashboardReveal 1s ease-out forwards; }
        @keyframes dashboardReveal { from{opacity:0; transform:scale(.95)} to{opacity:1; transform:scale(1)} }
        .video-grid { display:grid; grid-template-columns:1fr 1fr; gap:1.5rem; margin-bottom:1.5rem; }
        @media (max-width:1024px){ .video-grid{grid-template-columns:1fr} }
        .video-panel { background:var(--surface-dark); border:1px solid var(--border-color); border-radius:12px; overflow:hidden; position:relative; }
        .panel-header { background:var(--surface-mid); padding:1rem 1.5rem; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid var(--border-color); }
        .panel-title { display:flex; align-items:center; gap:.75rem; }
        .run-chip { background:var(--gradient-1); padding:.25rem .75rem; border-radius:20px; font-family:'Share Tech Mono',monospace; font-size:.875rem; font-weight:600; }
        .video-panel:nth-child(2) .run-chip { background:var(--gradient-2); }
        .timer { font-family:'Share Tech Mono',monospace; font-size:1.125rem; color:var(--accent-lime); background:var(--surface-dark); padding:.5rem 1rem; border-radius:6px; border:1px solid var(--accent-lime); letter-spacing:.05em; position:relative; overflow:hidden; }
        .timer::before { content:''; position:absolute; top:0; left:-100%; width:100%; height:100%; background:linear-gradient(90deg,transparent,rgba(168,255,0,.3),transparent); animation:timerSweep 2s linear infinite; }
        @keyframes timerSweep { 0%{left:-100%} 100%{left:100%} }
        .video-frame { width:100%; height:400px; background:#000; border:none; }
        .panel-footer { background:var(--surface-mid); padding:1rem 1.5rem; display:flex; justify-content:space-between; align-items:center; border-top:1px solid var(--border-color); }
        .metrics { display:flex; gap:2rem; }
        .metric { display:flex; flex-direction:column; gap:.25rem; }
        .metric-label { font-size:.75rem; color:var(--text-muted); text-transform:uppercase; letter-spacing:.05em; }
        .metric-value { font-family:'Share Tech Mono',monospace; font-size:1rem; color:var(--accent-teal); font-weight:600; }
        .sync-wrap { display:flex; flex-direction:column; align-items:flex-end; justify-content:flex-end; gap:.5rem; }
        .sync-buttons { display:flex; gap:.5rem; }
        .btn-sync { padding:.5rem 1rem; background:var(--surface-dark); border:1px solid var(--border-color); border-radius:4px; color:var(--text-secondary); font-family:'Share Tech Mono',monospace; font-size:.875rem; cursor:pointer; transition:.3s; }
        .btn-sync:hover { border-color:var(--accent-lime); color:var(--accent-lime); background:rgba(168,255,0,.1); }
        .start-offset { font-family:'Share Tech Mono',monospace; font-size:.85rem; color:var(--text-secondary); }

        .playback-controls { background:var(--surface-dark); border:1px solid var(--border-color); border-radius:12px; padding:1.5rem; margin-bottom:1.5rem; }
        .controls-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(100px, 1fr)); gap:1rem; margin-bottom:1.5rem; }
        .control-btn { padding:1rem; background:var(--surface-mid); border:1px solid var(--border-color); border-radius:8px; color:var(--text-primary); font-family:'Rajdhani',sans-serif; font-weight:600; text-align:center; cursor:pointer; transition:.3s; display:flex; flex-direction:column; align-items:center; gap:.5rem; }
        .control-btn:hover { background:var(--surface-light); border-color:var(--accent-orange); transform:translateY(-2px); box-shadow:0 10px 20px rgba(255,107,53,.2); }
        .control-icon { font-size:1.5rem; }
        .control-text { font-size:.875rem; text-transform:uppercase; letter-spacing:.05em; }

        .size-adjuster { background:var(--surface-mid); border:1px solid var(--border-color); border-radius:8px; padding:1rem 1.5rem; display:flex; align-items:center; gap:1.5rem; }
        .adjuster-label { font-weight:600; text-transform:uppercase; letter-spacing:.05em; min-width:80px; }
        .slider-track { flex:1; height:6px; background:var(--surface-dark); border-radius:3px; position:relative; cursor:pointer; }
        .slider-fill { position:absolute; top:0; left:0; height:100%; background:var(--gradient-3); border-radius:3px; width:50%; transition:width .3s ease; }
        .slider-thumb { position:absolute; top:50%; left:50%; width:20px; height:20px; background:var(--text-primary); border-radius:50%; transform:translate(-50%,-50%); cursor:grab; box-shadow:0 2px 10px rgba(0,0,0,.3); transition:.3s; }
        .slider-thumb:hover { transform:translate(-50%,-50%) scale(1.2); box-shadow:0 4px 20px rgba(168,255,0,.4); }
        .size-value { font-family:'Share Tech Mono',monospace; font-size:1.25rem; color:var(--accent-lime); min-width:60px; text-align:right; }

        .empty-dashboard { text-align:center; padding:6rem 2rem; opacity:0; animation:fadeInUp .8s ease-out .4s forwards; }
        .empty-icon { font-size:5rem; margin-bottom:2rem; filter:grayscale(1); opacity:.2; }
        .empty-title { font-family:'Bebas Neue',sans-serif; font-size:2.5rem; color:var(--text-secondary); margin-bottom:1rem; letter-spacing:.1em; }
        .empty-desc { font-size:1.125rem; color:var(--text-muted); max-width:500px; margin:0 auto; }

        .loading-overlay { position:fixed; inset:0; background:rgba(0,0,0,.9); display:flex; align-items:center; justify-content:center; z-index:9999; display:none; }
        .loader { width:60px; height:60px; border:3px solid var(--surface-light); border-radius:50%; border-top-color:var(--accent-orange); animation:spin 1s linear infinite; }
        @keyframes spin { to{ transform:rotate(360deg) } }

        /* Fullscreen mode */
        .fullscreen-mode { position:fixed; inset:0; background:var(--deep-black); z-index:9999; padding:2rem; display:flex; flex-direction:column; height:100vh; overflow-y:auto; -webkit-overflow-scrolling:touch; }
        .fullscreen-mode .video-grid { flex:1; }
        .fullscreen-mode .video-frame { height:calc(50vh - 120px); }
        .exit-fullscreen { position:fixed; top:2rem; right:2rem; z-index:10000; display:none; }
        .exit-fullscreen.show { display:inline-flex; }

        /* Share modal */
        .modal { position:fixed; inset:0; background:rgba(0,0,0,.95); backdrop-filter:blur(10px); display:none; align-items:center; justify-content:center; z-index:10000; }
        .modal.active { display:flex; }
        .modal-dialog { background:var(--surface-dark); border:1px solid var(--border-color); border-radius:12px; padding:2.5rem; max-width:600px; width:90%; animation:modalScale .3s ease-out; }
        @keyframes modalScale { from{transform:scale(.9); opacity:0} to{transform:scale(1); opacity:1} }
        .modal-header{ margin-bottom:2rem; }
        .modal-title { font-family:'Bebas Neue',sans-serif; font-size:2rem; margin:0; letter-spacing:.05em; }
        .modal-body { margin-bottom:2rem; }
        .share-input { width:100%; padding:1rem; background:var(--surface-mid); border:1px solid var(--border-color); border-radius:6px; color:var(--text-primary); font-family:'Share Tech Mono',monospace; font-size:.875rem; margin-top:1rem; }
        .modal-actions { display:flex; gap:1rem; justify-content:flex-end; }

        /* Compact mode */
        .compact-mode .panel-header, .compact-mode .panel-footer, .compact-mode .size-adjuster, .compact-mode .dashboard-header { display:none !important; }
        .compact-mode { padding:.5rem !important; }
        .compact-mode .video-grid { gap:.5rem; margin-bottom:.5rem; }
        .compact-mode .video-panel { border-radius:0; }
        .compact-mode .video-frame { height:calc(50vh - 60px) !important; }
        .compact-mode .playback-controls { padding:.75rem; margin-bottom:0; border-radius:0; }
        .compact-mode .controls-grid { margin-bottom:0; }
        .compact-mode .control-btn { padding:.75rem; }
        .compact-mode .control-icon { font-size:1.25rem; }
        .compact-mode .control-text { display:none; }
        .exit-compact { position:fixed; top:.5rem; right:.5rem; z-index:1000; background:var(--surface-dark); border:1px solid var(--border-color); padding:.5rem 1rem; border-radius:6px; }

        @media (max-width:768px){
  .header-content{flex-direction:column; gap:1rem; text-align:center}
  .logo{font-size:2.5rem}
  .control-actions{flex-direction:column}
  .btn{width:100%}
  .video-grid{grid-template-columns:1fr}
  .panel-footer{flex-direction:column; align-items:stretch; gap:0.75rem;}
  .sync-wrap{align-items:stretch}
  .sync-buttons{flex-wrap:wrap}
  .start-offset .form-input{width:100px}
}
.logo{font-size:2.5rem} .control-actions{flex-direction:column} .btn{width:100%} }
            /* Desktop-only hotkey help */
        .hotkey-toggle { position:fixed; right:1.25rem; bottom:1.25rem; z-index:10001; padding:.6rem .8rem; border:1px solid var(--border-color); border-radius:999px; background:var(--surface-mid); color:var(--text-primary); font-weight:700; cursor:pointer; box-shadow:0 6px 20px rgba(0,0,0,.35); }
        .hotkey-toggle:hover { background:var(--surface-light); }
        .hotkey-panel { position:fixed; right:1.25rem; bottom:4.25rem; width:320px; max-width:85vw; z-index:10001; background:var(--surface-dark); border:1px solid var(--border-color); border-radius:12px; padding:1rem 1rem 1.25rem; box-shadow:0 16px 40px rgba(0,0,0,.5); opacity:0; transform:translateY(10px); transition:.2s ease; pointer-events:none; }
        .hotkey-panel.show { opacity:1; transform:translateY(0); pointer-events:auto; }
        .hotkey-panel h4 { margin:.25rem 0 .5rem; font-family:'Bebas Neue',sans-serif; letter-spacing:.04em; font-size:1.25rem; }
        .hotkey-grid { display:grid; grid-template-columns:auto 1fr; gap:.35rem .75rem; font-family:'Share Tech Mono',monospace; font-size:.9rem; }
        .keycap { display:inline-block; padding:.1rem .45rem; border:1px solid var(--border-color); border-radius:6px; background:var(--surface-mid); }
        @media (max-width:768px){ .hotkey-toggle, .hotkey-panel { display:none !important; } }
    </style>
</head>
<body>
    <div class="bg-mesh"><div class="mesh-gradient"></div></div>
    <div class="data-streams"><div class="stream"></div><div class="stream"></div><div class="stream"></div><div class="stream"></div><div class="stream"></div></div>

    <header class="dashboard-header">
        <div class="header-content">
            <div class="logo-section">
                <h1 class="logo">RaceCompare</h1>
            </div>
            <div class="status-indicator"><span class="status-dot"></span><span class="status-text">System Online</span></div>
        </div>
    </header>

    <div class="dashboard-container">
        <!-- Configuration Section -->
        <div class="config-section">
            <div class="config-card">
                <div class="card-header">
                    <div class="card-label">
                        <div class="run-badge">A</div>
                        <div>
                            <h3 class="card-title">Run A Configuration</h3>
                            <p class="card-subtitle">First Performance Run</p>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">YouTube Video URL</label>
                        <input type="text" class="form-input" id="video1Url" placeholder="https://www.youtube.com/watch?v=..." value="" />
                    </div>
                </div>
            </div>
            <div class="config-card">
                <div class="card-header">
                    <div class="card-label">
                        <div class="run-badge">B</div>
                        <div>
                            <h3 class="card-title">Run B Configuration</h3>
                            <p class="card-subtitle">Second Performance Run</p>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">YouTube Video URL</label>
                        <input type="text" class="form-input" id="video2Url" placeholder="https://www.youtube.com/watch?v=..." value="" />
                    </div>
                </div>
            </div>
        </div>

        <!-- Control Center -->
        <div class="control-center">
            <div class="control-actions">
                <button id="loadVideosBtn" class="btn btn-primary"><span>üöÄ</span><span id="loadBtnText">Launch Analysis</span></button>
                <button id="shareBtn" class="btn btn-secondary" onclick="showShareModal()"><span>üîó</span>Share Configuration</button>
                <button id="fullscreenBtn" class="btn btn-secondary" style="display:none;"><span>‚õ∂</span>Fullscreen View</button>
                
                <button id="resetBtn" class="btn btn-secondary" style="display:none;">‚Ü∫ Reset</button>
            </div>
        </div>

        <div id="emptyDashboard" class="empty-dashboard">
            <div class="empty-icon">üìä</div>
            <h2 class="empty-title">NO DATA LOADED</h2>
            <p class="empty-desc">Paste two YouTube links and launch analysis to begin side‚Äëby‚Äëside comparison.</p>
        </div>

        <div id="analysisDashboard" class="analysis-dashboard">
            <div class="video-grid">
                <div class="video-panel">
                    <div class="panel-header">
                        <div class="panel-title"><span class="run-chip">RUN A</span><span>Performance Analysis</span></div>
                        <div class="timer" id="timer1">00:00.00</div>
                    </div>
                    <iframe id="iframe1" class="video-frame" style="display:none;" allowfullscreen></iframe>
                    <div id="player1" class="video-frame"></div>
                    <div class="panel-footer">
                        <div class="metrics">
                            <div class="metric"><span class="metric-label">Status</span><span class="metric-value" id="status1">READY</span></div>
                            <div class="metric"><span class="metric-label">Elapsed</span><span class="metric-value" id="elapsed1">0.0s</span></div>
                        </div>
                        <div class="sync-wrap">
                            <div class="sync-buttons">
                                <button class="btn-sync" onclick="adjustTime(1,-1)">-1s</button>
                                <button class="btn-sync" onclick="adjustTime(1,-0.1)">-0.1s</button>
                                <button class="btn-sync" onclick="adjustTime(1,0.1)">+0.1s</button>
                                <button class="btn-sync" onclick="adjustTime(1,1)">+1s</button>
                            </div>
                            <label class="start-offset">Start Offset:
    <input type="number" step="0.1" min="0" id="offsetInput1" class="form-input" style="width:120px;display:inline-block;margin-left:.5rem;" value="0.0" /> s
</label>
                        </div>
                    </div>
                </div>

                <div class="video-panel">
                    <div class="panel-header">
                        <div class="panel-title"><span class="run-chip">RUN B</span><span>Performance Analysis</span></div>
                        <div class="timer" id="timer2">00:00.00</div>
                    </div>
                    <iframe id="iframe2" class="video-frame" style="display:none;" allowfullscreen></iframe>
                    <div id="player2" class="video-frame"></div>
                    <div class="panel-footer">
                        <div class="metrics">
                            <div class="metric"><span class="metric-label">Status</span><span class="metric-value" id="status2">READY</span></div>
                            <div class="metric"><span class="metric-label">Elapsed</span><span class="metric-value" id="elapsed2">0.0s</span></div>
                        </div>
                        <div class="sync-wrap">
                            <div class="sync-buttons">
                                <button class="btn-sync" onclick="adjustTime(2,-1)">-1s</button>
                                <button class="btn-sync" onclick="adjustTime(2,-0.1)">-0.1s</button>
                                <button class="btn-sync" onclick="adjustTime(2,0.1)">+0.1s</button>
                                <button class="btn-sync" onclick="adjustTime(2,1)">+1s</button>
                            </div>
                            <label class="start-offset">Start Offset:
    <input type="number" step="0.1" min="0" id="offsetInput2" class="form-input" style="width:120px;display:inline-block;margin-left:.5rem;" value="0.0" /> s
</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="playback-controls">
                <div class="controls-grid">
                    <button class="control-btn" id="playBtn"><span class="control-icon">‚ñ∂</span><span class="control-text">Play</span></button>
                    <button class="control-btn" id="pauseBtn"><span class="control-icon">‚è∏</span><span class="control-text">Pause</span></button>
                    <button class="control-btn" id="restartBtn"><span class="control-icon">‚Ü∫</span><span class="control-text">Restart</span></button>
                    <button class="control-btn" id="rewindBtn"><span class="control-icon">‚è™</span><span class="control-text">-5 Sec</span></button>
                </div>
                <div class="size-adjuster">
                    <span class="adjuster-label">View Size</span>
                    <div class="slider-track" id="sliderTrack">
                        <div class="slider-fill" id="sliderFill"></div>
                        <div class="slider-thumb" id="sliderThumb"></div>
                    </div>
                    <span class="size-value" id="sizeValue">100%</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay"><div class="loader"></div></div>

    <!-- Share Modal -->
    <div class="modal" id="shareModal">
        <div class="modal-dialog">
            <div class="modal-header"><h2 class="modal-title">SHARE CONFIGURATION</h2></div>
            <div class="modal-body">
                <p>Copy this URL to share your analysis configuration:</p>
                <input type="text" class="share-input" id="shareUrl" readonly />
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeShareModal()">Close</button>
                <button class="btn btn-primary" onclick="copyShareUrl(event)">Copy URL</button>
            </div>
        </div>
    </div>

    <!-- Floating Exit Fullscreen Button -->
    <button id="exitFullscreenBtn" class="btn btn-secondary exit-fullscreen">‚§¢ Exit Fullscreen</button>
    <!-- Desktop-only Hotkey Help -->
    <button id="hotkeyToggle" class="hotkey-toggle" title="Keyboard Shortcuts">?</button>
    <div id="hotkeyPanel" class="hotkey-panel" aria-hidden="true">
        <h4>Keyboard Shortcuts</h4>
        <div class="hotkey-grid">
            <span class="keycap">Space</span><span>Play / Pause</span>
            <span class="keycap">R</span><span>Restart</span>
            <span class="keycap">J</span><span>Rewind 5s</span>
            <span class="keycap">L</span><span>Forward 5s</span>
            <span class="keycap">F</span><span>Toggle Fullscreen</span>
            <span class="keycap">[</span><span>Run A ‚àí0.1s (Shift ‚àí1.0s)</span>
            <span class="keycap">]</span><span>Run A +0.1s (Shift +1.0s)</span>
            <span class="keycap">;</span><span>Run B ‚àí0.1s (Shift ‚àí1.0s)</span>
            <span class="keycap">'</span><span>Run B +0.1s (Shift +1.0s)</span>
        </div>
    </div>

    <script>
        // Globals
        let player1, player2;
        let video1StartTime = 0;
        let video2StartTime = 0;
        let players = [];
        let apiReady = false;
        let isFullscreen = false;
        let isCompact = false;
        let timeUpdateInterval;
        let sliderValue = 100;
        let requestFullscreenOnLoad = false;

        // Custom slider
        function initializeSlider(){
            const track = document.getElementById('sliderTrack');
            const thumb = document.getElementById('sliderThumb');
            const fill = document.getElementById('sliderFill');
            const valueDisplay = document.getElementById('sizeValue');
            let isDragging = false;
            function updateSlider(e){
                const rect = track.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const percentage = Math.max(0, Math.min(100, (x/rect.width)*100));
                const value = Math.round(50 + (percentage/100)*100);
                sliderValue = value; thumb.style.left = percentage+'%'; fill.style.width = percentage+'%'; valueDisplay.textContent = value+'%';
                document.querySelectorAll('.video-frame').forEach(f=>{ f.style.height = (400*value/100)+'px'; });
            }
            thumb.addEventListener('mousedown', ()=>{ isDragging=true; });
            document.addEventListener('mousemove', e=>{ if(isDragging) updateSlider(e); });
            document.addEventListener('mouseup', ()=>{ isDragging=false; });
            track.addEventListener('click', updateSlider);
        }

        // URL params
        function loadFromURLParams(){
            const urlParams = new URLSearchParams(window.location.search);
            const video1 = urlParams.get('v1') || urlParams.get('video1');
            const video2 = urlParams.get('v2') || urlParams.get('video2');
            const start1 = urlParams.get('t1') || urlParams.get('start1');
            const start2 = urlParams.get('t2') || urlParams.get('start2');
            const autoload = urlParams.get('autoload') || urlParams.get('auto');
            const fs = urlParams.get('fs') || urlParams.get('fullscreen');
            if(video1) document.getElementById('video1Url').value = video1;
            if(video2) document.getElementById('video2Url').value = video2;
            if(start1) video1StartTime = Math.max(0, parseFloat(start1)||0);
            if(start2) video2StartTime = Math.max(0, parseFloat(start2)||0);
            updateOffsetDisplays();
            if((fs === '1' || fs === 'true')) requestFullscreenOnLoad = true;
            if(autoload === 'true' && video1 && video2){ setTimeout(()=>{ loadVideos(); }, 700); }
        }

        function generateShareableURL(){
            const baseURL = window.location.origin + window.location.pathname;
            const video1 = document.getElementById('video1Url').value.trim();
            const video2 = document.getElementById('video2Url').value.trim();
            if(!video1 || !video2){ alert('Please enter both YouTube URLs before sharing'); return; }
            const params = new URLSearchParams({ v1: video1, v2: video2, t1: video1StartTime.toFixed(1), t2: video2StartTime.toFixed(1), autoload: 'true', fs: '1' });
            return `${baseURL}?${params.toString()}`;
        }
        function showShareModal(){ const url = generateShareableURL(); if(!url) return; document.getElementById('shareUrl').value = url; document.getElementById('shareModal').classList.add('active'); }
        function closeShareModal(){ document.getElementById('shareModal').classList.remove('active'); }
        function copyShareUrl(e){ const input = document.getElementById('shareUrl'); input.select(); document.execCommand('copy'); const btn = e.target; const original = btn.textContent; btn.textContent='Copied!'; btn.style.background='var(--gradient-3)'; setTimeout(()=>{ btn.textContent=original; btn.style.background=''; }, 1500); }

        // YouTube API
        function onYouTubeIframeAPIReady(){ apiReady = true; updateApiStatus(true); }
        function updateApiStatus(ready){ const loadBtn=document.getElementById('loadVideosBtn'); const btnText=document.getElementById('loadBtnText'); const statusText=document.querySelector('.status-text'); if(ready){ btnText.textContent='Launch Analysis'; statusText.textContent='System Online'; } else { btnText.textContent='Launch Analysis (API Loading)'; statusText.textContent='System Online'; } loadBtn.disabled=false; }
        function extractVideoId(url){ const regExp=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/; const m=url.match(regExp); return (m && m[7].length===11) ? m[7] : false; }
        function formatTime(seconds){ const mins=Math.floor(seconds/60); const secs=Math.floor(seconds%60); const ms=Math.floor((seconds%1)*100); return `${String(mins).padStart(2,'0')}:${String(secs).padStart(2,'0')}.${String(ms).padStart(2,'0')}`; }

        function loadVideos(){
            const video1Url=document.getElementById('video1Url').value.trim();
            const video2Url=document.getElementById('video2Url').value.trim();
            const videoId1=extractVideoId(video1Url); const videoId2=extractVideoId(video2Url);
            if(!videoId1 || !videoId2){ alert('Please enter valid YouTube URLs'); return; }
            document.getElementById('loadingOverlay').style.display='flex';
            setTimeout(()=>{
                if(apiReady){ loadWithAPI(videoId1, videoId2); } else { loadWithIframes(videoId1, videoId2); }
                document.getElementById('loadingOverlay').style.display='none';
                document.getElementById('emptyDashboard').style.display='none';
                document.getElementById('analysisDashboard').classList.add('active');
                document.getElementById('fullscreenBtn').style.display='inline-flex';
                                document.getElementById('resetBtn').style.display='inline-flex';
                document.getElementById('timer1').textContent=formatTime(video1StartTime);
                document.getElementById('timer2').textContent=formatTime(video2StartTime);
                if(requestFullscreenOnLoad){ requestFullscreenOnLoad=false; if(!isFullscreen) toggleFullscreen(); }
            }, 600);
        }

        function loadWithAPI(videoId1, videoId2){
            document.getElementById('iframe1').style.display='none';
            document.getElementById('iframe2').style.display='none';
            document.getElementById('player1').style.display='block';
            document.getElementById('player2').style.display='block';
            if(player1) player1.destroy(); if(player2) player2.destroy();
            player1 = new YT.Player('player1', { height:'100%', width:'100%', videoId:videoId1, playerVars:{ start:Math.floor(video1StartTime), controls:1, rel:0, modestbranding:1, fs:1, iv_load_policy:3, disablekb:0, playsinline:1, cc_load_policy:0, origin:window.location.origin }, events:{ onReady:onPlayerReady, onStateChange:onPlayerStateChange } });
            player2 = new YT.Player('player2', { height:'100%', width:'100%', videoId:videoId2, playerVars:{ start:Math.floor(video2StartTime), controls:1, rel:0, modestbranding:1, fs:1, iv_load_policy:3, disablekb:0, playsinline:1, cc_load_policy:0, origin:window.location.origin }, events:{ onReady:onPlayerReady, onStateChange:onPlayerStateChange } });
            players = [player1, player2]; enableSyncControls(true);
        }
        function loadWithIframes(videoId1, videoId2){
            document.getElementById('player1').style.display='none';
            document.getElementById('player2').style.display='none';
            document.getElementById('iframe1').style.display='block';
            document.getElementById('iframe2').style.display='block';
            const embedUrl1=`https://www.youtube.com/embed/${videoId1}?start=${Math.floor(video1StartTime)}&autoplay=0&controls=1&rel=0`;
            const embedUrl2=`https://www.youtube.com/embed/${videoId2}?start=${Math.floor(video2StartTime)}&autoplay=0&controls=1&rel=0`;
            document.getElementById('iframe1').src=embedUrl1; document.getElementById('iframe2').src=embedUrl2;
            document.getElementById('status1').textContent='IFRAME MODE';
            document.getElementById('status2').textContent='IFRAME MODE';
            enableSyncControls(false);
        }
        function enableSyncControls(enable){ ['playBtn','pauseBtn','restartBtn','rewindBtn'].forEach(id=>{ const b=document.getElementById(id); b.disabled=!enable; b.style.opacity= enable ? '1' : '.5'; b.title = enable ? '' : 'Sync controls require API'; }); }
        function onPlayerReady(e){ if(e.target===player1){ player1.seekTo(video1StartTime,true); updateStatus(1,'READY'); } else { player2.seekTo(video2StartTime,true); updateStatus(2,'READY'); } if(!timeUpdateInterval){ timeUpdateInterval=setInterval(updateVideoTimes,100); } }
        function formatOffset(v){ return (Math.round(v*10)/10).toFixed(1)+'s'; }
        function updateOffsetDisplays(){
    const i1 = document.getElementById('offsetInput1');
    const i2 = document.getElementById('offsetInput2');
    if(i1) i1.value = (Math.round(video1StartTime*10)/10).toFixed(1);
    if(i2) i2.value = (Math.round(video2StartTime*10)/10).toFixed(1);
}
        function updateVideoTimes(){
            if(player1 && player1.getCurrentTime){ const ct=player1.getCurrentTime(); const el=ct - video1StartTime; document.getElementById('timer1').textContent=formatTime(ct); document.getElementById('elapsed1').textContent=(Math.max(0,el)).toFixed(1)+'s'; }
            if(player2 && player2.getCurrentTime){ const ct=player2.getCurrentTime(); const el=ct - video2StartTime; document.getElementById('timer2').textContent=formatTime(ct); document.getElementById('elapsed2').textContent=(Math.max(0,el)).toFixed(1)+'s'; }
        }
        function updateStatus(n, status){ document.getElementById(`status${n}`).textContent = status; }
        function onPlayerStateChange(e){ if(e.data===YT.PlayerState.PLAYING){ updateStatus(e.target===player1?1:2,'PLAYING'); players.forEach(p=>{ if(p!==e.target && p.getPlayerState()!==YT.PlayerState.PLAYING) p.playVideo(); }); } else if(e.data===YT.PlayerState.PAUSED){ updateStatus(e.target===player1?1:2,'PAUSED'); players.forEach(p=>{ if(p!==e.target && p.getPlayerState()===YT.PlayerState.PLAYING) p.pauseVideo(); }); } }

        // Controls
        function playBoth(){ if(!apiReady) return; players.forEach(p=>{ if(p&&p.playVideo) p.playVideo(); }); }
        function pauseBoth(){ if(!apiReady) return; players.forEach(p=>{ if(p&&p.pauseVideo) p.pauseVideo(); }); }
        function restartBoth(){ if(!apiReady) return; if(player1) player1.seekTo(video1StartTime,true); if(player2) player2.seekTo(video2StartTime,true); setTimeout(playBoth,100); }
        function rewindBoth(){ if(!apiReady) return; players.forEach(p=>{ if(p&&p.getCurrentTime&&p.seekTo){ const base=(p===player1?video1StartTime:video2StartTime); const ct=p.getCurrentTime(); const target=Math.max(ct-5, base); p.seekTo(target,true); } }); }
        function forwardBoth(){ if(!apiReady) return; players.forEach(p=>{ if(p&&p.getCurrentTime&&p.seekTo){ const ct=p.getCurrentTime(); p.seekTo(ct+5,true); } }); }
        function adjustTime(playerNum, adj){
            if(playerNum===1){
                video1StartTime = Math.max(0, +(video1StartTime + adj).toFixed(1));
                const i1 = document.getElementById('offsetInput1'); if(i1) i1.value = video1StartTime.toFixed(1);
                if(player1) player1.seekTo(video1StartTime,true);
            } else {
                video2StartTime = Math.max(0, +(video2StartTime + adj).toFixed(1));
                const i2 = document.getElementById('offsetInput2'); if(i2) i2.value = video2StartTime.toFixed(1);
                if(player2) player2.seekTo(video2StartTime,true);
            }
            updateOffsetDisplays();
        }

        function toggleFullscreen(){
    const dashboard = document.getElementById('analysisDashboard');
    const btn = document.getElementById('fullscreenBtn');
    const exitBtn = document.getElementById('exitFullscreenBtn');
    const container = document.querySelector('.dashboard-container');

    if (isFullscreen) {
        // EXIT fullscreen
        dashboard.classList.remove('fullscreen-mode');
        container.classList.remove('compact-mode');
        if (btn) btn.innerHTML = '<span>‚õ∂</span>Fullscreen View';
        if (exitBtn) exitBtn.classList.remove('show');
        isFullscreen = false;
    } else {
        // ENTER fullscreen (mobile also gets compact UI)
        dashboard.classList.add('fullscreen-mode');
        if (window.innerWidth <= 768) { container.classList.add('compact-mode'); }
        if (btn) btn.innerHTML = '<span>‚õ∂</span>Exit Fullscreen';
        if (exitBtn) exitBtn.classList.add('show');
        isFullscreen = true;
    }
}

function resetAll(){
            // Destroy players
            try{ if(player1 && player1.destroy) player1.destroy(); }catch{}
            try{ if(player2 && player2.destroy) player2.destroy(); }catch{}
            player1 = player2 = null; players = [];
            clearInterval(timeUpdateInterval); timeUpdateInterval = null;
            // Clear iframes
            document.getElementById('iframe1').src = ''; document.getElementById('iframe2').src='';
            // Reset UI
            document.getElementById('analysisDashboard').classList.remove('active');
            document.getElementById('emptyDashboard').style.display='block';
            document.getElementById('fullscreenBtn').style.display='none';
                        document.getElementById('resetBtn').style.display='none';
            // Exit fullscreen/compact if needed
            if(isFullscreen){ toggleFullscreen(); }
            
            // Reset times and displays
            video1StartTime = 0; video2StartTime = 0; updateOffsetDisplays();
            document.getElementById('timer1').textContent='00:00.00';
            document.getElementById('timer2').textContent='00:00.00';
            document.getElementById('elapsed1').textContent='0.0s';
            document.getElementById('elapsed2').textContent='0.0s';
            document.getElementById('status1').textContent='READY';
            document.getElementById('status2').textContent='READY';
            // Clear URLs
            document.getElementById('video1Url').value='';
            document.getElementById('video2Url').value='';
            // Show players containers again for next load
            document.getElementById('player1').style.display='block';
            document.getElementById('player2').style.display='block';
            document.getElementById('iframe1').style.display='none';
            document.getElementById('iframe2').style.display='none';
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
    loadFromURLParams();
    updateApiStatus(false);
    initializeSlider();
    updateOffsetDisplays();

    // Button wiring
    const byId = (id) => document.getElementById(id);
    byId('loadVideosBtn').onclick = loadVideos;
    byId('fullscreenBtn').onclick = toggleFullscreen;
    byId('exitFullscreenBtn').onclick = toggleFullscreen;
    byId('playBtn').onclick = playBoth;
    byId('pauseBtn').onclick = pauseBoth;
    byId('restartBtn').onclick = restartBoth;
    byId('rewindBtn').onclick = rewindBoth;
    byId('resetBtn').onclick = resetAll;

    // Share modal backdrop click
    byId('shareModal').onclick = (e) => { if (e.target === e.currentTarget) closeShareModal(); };

    // Offset input listeners
    const i1 = byId('offsetInput1');
    const i2 = byId('offsetInput2');
    if (i1) {
        i1.addEventListener('change', () => {
            const v = Math.max(0, parseFloat(i1.value) || 0);
            video1StartTime = +v.toFixed(1);
            if (player1) player1.seekTo(video1StartTime, true);
            updateOffsetDisplays();
        });
    }
    if (i2) {
        i2.addEventListener('change', () => {
            const v = Math.max(0, parseFloat(i2.value) || 0);
            video2StartTime = +v.toFixed(1);
            if (player2) player2.seekTo(video2StartTime, true);
            updateOffsetDisplays();
        });
    }

    // Keyboard shortcuts (ignored while typing in inputs/textareas)
    document.addEventListener('keydown', (e) => {
        const tag = (e.target && e.target.tagName) || '';
        if (tag === 'INPUT' || tag === 'TEXTAREA') return;

        // Space toggles play/pause
        if (e.key === ' ') {
            e.preventDefault();
            if (player1 && player1.getPlayerState && player1.getPlayerState() === YT.PlayerState.PLAYING) {
                pauseBoth();
            } else {
                playBoth();
            }
            return;
        }

        if (e.key === 'j' || e.key === 'J') { rewindBoth(); return; }
        if (e.key === 'l' || e.key === 'L') { forwardBoth(); return; }
        if (e.key === 'r' || e.key === 'R') { restartBoth(); return; }
        if (e.key === 'f' || e.key === 'F') { toggleFullscreen(); return; }

        // Offsets
        if (e.key === '[') { adjustTime(1, e.shiftKey ? -1.0 : -0.1); return; }
        if (e.key === ']') { adjustTime(1, e.shiftKey ? +1.0 : +0.1); return; }
        if (e.key === ';') { adjustTime(2, e.shiftKey ? -1.0 : -0.1); return; }
        if (e.key === "'") { adjustTime(2, e.shiftKey ? +1.0 : +0.1); return; }

        // Toggle hotkey panel with ? (Shift+/)
        if (e.key === '?' || (e.shiftKey && e.key === '/')) {
            const t = byId('hotkeyToggle');
            if (t) t.click();
            return;
        }

        if (e.key === 'Escape') {
            const p = byId('hotkeyPanel');
            if (p) p.classList.remove('show');
            return;
        }
    });

    // Hotkey help wiring (desktop only)
    const hkToggle = byId('hotkeyToggle');
    const hkPanel = byId('hotkeyPanel');
    if (hkToggle && hkPanel) {
        const togglePanel = () => {
            hkPanel.classList.toggle('show');
            hkPanel.setAttribute('aria-hidden', hkPanel.classList.contains('show') ? 'false' : 'true');
        };
        hkToggle.addEventListener('click', togglePanel);
        document.addEventListener('click', (e) => {
            if (!hkPanel.classList.contains('show')) return;
            if (!hkPanel.contains(e.target) && e.target !== hkToggle) hkPanel.classList.remove('show');
        });
    }
});
</script>
</body>
</html>
